<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLAM Auction Interactive - Bridge Bidding Trainer</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { margin: 0; font-family: 'DM Sans', -apple-system, sans-serif; }
        #root { min-height: 100vh; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Utility functions
        const formatBid = (bid) => {
          if (bid === 'Pass') return 'Pass';
          if (bid === 'X') return 'X';
          if (bid === 'XX') return 'XX';
          const suits = { C: 'â™£', D: 'â™¦', H: 'â™¥', S: 'â™ ' };
          const level = bid.charAt(0);
          const suit = bid.substring(1);
          return suit === 'NT' ? `${level}NT` : `${level}${suits[suit]}`;
        };

        const getNextSeat = (seat) => {
          const seats = ['N', 'E', 'S', 'W'];
          return seats[(seats.indexOf(seat) + 1) % 4];
        };

        // Training scenarios with all 4 hands - organized by module
        const SCENARIOS = [
          // ========== UNCONTESTED AUCTIONS (BASIC) ==========
          {
            id: "U01",
            module: "BASIC",
            title: "Stayman after 1NT",
            dealer: "N",
            vul: "None",
            your_seat: "S",
            hands: {
              N: { S: "A105", H: "KQ84", D: "AQ6", C: "K73" },
              E: { S: "9632", H: "J105", D: "10984", C: "Q4" },
              S: { S: "KJ84", H: "A963", D: "K72", C: "85" },
              W: { S: "Q7", H: "72", D: "J53", C: "AJ10962" }
            },
            correct_bid: "2C",
            alternatives: [],
            teaching_point: "Use Stayman (2â™£) to find 4-4 major fit after partner's 1NT opening",
            optimal_contract: "4H by N",
            explanation: [
              "With 10 HCP and both majors, use Stayman (2â™£) to find a 4-4 major fit.",
              "Partner will bid 2â™¥ showing 4+ hearts, then you'll raise to 4â™¥."
            ]
          },
          {
            id: "U02",
            module: "BASIC",
            title: "Jacoby Transfer",
            dealer: "N",
            vul: "None",
            your_seat: "S",
            hands: {
              N: { S: "A105", H: "KQ84", D: "AQ6", C: "K73" },
              E: { S: "632", H: "J1052", D: "J984", C: "Q4" },
              S: { S: "Q109764", H: "K5", D: "Q83", C: "72" },
              W: { S: "KJ8", H: "A73", D: "K1075", C: "AJ10" }
            },
            correct_bid: "2H",
            alternatives: [],
            teaching_point: "Use Jacoby Transfer (2â™¥) to transfer to spades and get opener as declarer",
            optimal_contract: "2S by N",
            explanation: [
              "With 6 spades and weak hand, transfer with 2â™¥.",
              "Partner accepts with 2â™ , making them declarer in your long suit."
            ]
          },
          {
            id: "U03",
            module: "BASIC",
            title: "2/1 Game Force",
            dealer: "N",
            vul: "None",
            your_seat: "S",
            hands: {
              N: { S: "AKJ84", H: "K6", D: "A84", C: "Q73" },
              E: { S: "632", H: "J1052", D: "J109", C: "854" },
              S: { S: "Q5", H: "A983", D: "KQ62", C: "AK2" },
              W: { S: "1097", H: "Q74", D: "753", C: "J1096" }
            },
            correct_bid: "2D",
            alternatives: [],
            teaching_point: "Bid a new suit at the 2-level to establish game force with 13+ HCP",
            optimal_contract: "6S by N",
            explanation: [
              "With 18 HCP and fit for partner's spades, bid 2â™¦ (game force).",
              "This starts exploration for slam with unlimited bidding space."
            ]
          },
          {
            id: "U04",
            module: "BASIC",
            title: "Weak Two Response",
            dealer: "N",
            vul: "None",
            your_seat: "S",
            hands: {
              N: { S: "KQJ1095", H: "84", D: "Q105", C: "72" },
              E: { S: "32", H: "KJ1052", D: "J94", C: "Q84" },
              S: { S: "A874", H: "A96", D: "AK62", C: "AK" },
              W: { S: "6", H: "Q73", D: "873", C: "J109653" }
            },
            correct_bid: "4S",
            alternatives: ["6S"],
            teaching_point: "With 20+ HCP and 3-card support, jump directly to game after weak 2",
            optimal_contract: "4S by N",
            explanation: [
              "Partner's weak 2â™  shows 6 spades and 6-10 HCP.",
              "With 20 HCP and 4-card support, bid game directly."
            ]
          },
          {
            id: "U05",
            module: "BASIC",
            title: "Invitational Raise",
            dealer: "S",
            vul: "None",
            your_seat: "N",
            hands: {
              N: { S: "K84", H: "AJ63", D: "Q72", C: "K85" },
              E: { S: "9632", H: "Q105", D: "J984", C: "Q4" },
              S: { S: "AQJ105", H: "K84", D: "A6", C: "A73" },
              W: { S: "7", H: "972", D: "K1053", C: "J10962" }
            },
            correct_bid: "3S",
            alternatives: [],
            teaching_point: "With 4-card support and 11 HCP, make an invitational raise to 3",
            optimal_contract: "4S by S",
            explanation: [
              "With 11 HCP and 4-card support, invite game with 3â™ .",
              "Partner with 16 HCP will accept and bid 4â™ ."
            ]
          },

          // ========== COMPETITIVE AUCTIONS ==========
          {
            id: "C01",
            module: "COMPETE",
            title: "Negative Double",
            dealer: "W",
            vul: "None",
            your_seat: "S",
            hands: {
              N: { S: "AK843", H: "K6", D: "A84", C: "Q73" },
              E: { S: "Q2", H: "QJ1095", D: "J109", C: "854" },
              S: { S: "J65", H: "A832", D: "KQ62", C: "A2" },
              W: { S: "1097", H: "74", D: "753", C: "KJ1096" }
            },
            correct_bid: "X",
            alternatives: [],
            teaching_point: "Use negative double to show 4+ hearts after partner opens and RHO overcalls",
            optimal_contract: "4H by S",
            explanation: [
              "After 1â™  - 2â™¥, double shows 4+ in the other major (hearts).",
              "This is more flexible than bidding 3â™¥ which shows 5."
            ]
          },
          {
            id: "C02",
            module: "COMPETE",
            title: "Michaels Cue Bid",
            dealer: "E",
            vul: "E/W",
            your_seat: "S",
            hands: {
              N: { S: "KJ843", H: "6", D: "A842", C: "Q73" },
              E: { S: "A2", H: "KQJ95", D: "J9", C: "A854" },
              S: { S: "Q10765", H: "A10832", D: "6", C: "K2" },
              W: { S: "9", H: "74", D: "KQ10753", C: "J1096" }
            },
            correct_bid: "2H",
            alternatives: [],
            teaching_point: "Michaels cue bid shows 5-5 in hearts and spades over minor opening",
            optimal_contract: "3S by S",
            explanation: [
              "2â™¥ (cue of opener's suit) shows both majors, 5-5 distribution.",
              "This describes your hand perfectly in one bid."
            ]
          },
          {
            id: "C03",
            module: "COMPETE",
            title: "Unusual 2NT",
            dealer: "S",
            vul: "None",
            your_seat: "W",
            hands: {
              N: { S: "KJ84", H: "AK63", D: "72", C: "K85" },
              E: { S: "9632", H: "Q105", D: "J984", C: "Q" },
              S: { S: "AQ105", H: "J84", D: "A6", C: "A732" },
              W: { S: "7", H: "972", D: "KQ1053", C: "J10964" }
            },
            correct_bid: "2NT",
            alternatives: [],
            teaching_point: "Unusual 2NT shows 5-5 in lowest unbid suits (minors over major)",
            optimal_contract: "3D by W",
            explanation: [
              "After 1â™ , 2NT shows both minors (5-5 or better).",
              "This is an effective way to compete with two-suited hands."
            ]
          },
          {
            id: "C04",
            module: "COMPETE",
            title: "Cue Bid After Overcall",
            dealer: "W",
            vul: "None",
            your_seat: "S",
            hands: {
              N: { S: "AK843", H: "K62", D: "A84", C: "Q7" },
              E: { S: "Q2", H: "J954", D: "J109", C: "8543" },
              S: { S: "Q1096", H: "K3", D: "AJ84", C: "A72" },
              W: { S: "J75", H: "AQ10987", D: "Q7", C: "KJ" }
            },
            correct_bid: "2H",
            alternatives: [],
            teaching_point: "Cue bid opponent's suit to show game-forcing raise for partner",
            optimal_contract: "4S by N",
            explanation: [
              "After 1â™  - (2â™¥), cue 2â™¥ shows 4+ spades and game-forcing values.",
              "This is stronger than jumping to 3â™ ."
            ]
          },
          {
            id: "C05",
            module: "COMPETE",
            title: "Limit Raise in Competition",
            dealer: "N",
            vul: "N/S",
            your_seat: "S",
            hands: {
              N: { S: "AKJ84", H: "K6", D: "Q84", C: "A73" },
              E: { S: "32", H: "AJ1052", D: "J109", C: "Q84" },
              S: { S: "Q1065", H: "983", D: "AK62", C: "K2" },
              W: { S: "97", H: "Q74", D: "753", C: "J10965" }
            },
            correct_bid: "3S",
            alternatives: [],
            teaching_point: "Jump raise to 3 level shows 4-card support and 10-12 HCP in competition",
            optimal_contract: "4S by N",
            explanation: [
              "After 1â™  - (2â™¥) - ?, jump to 3â™  shows invitational values.",
              "This is different from uncontested where 3â™  is weaker."
            ]
          },

          // ========== DEFENSIVE AUCTIONS ==========
          {
            id: "D01",
            module: "DEFENSE",
            title: "Takeout Double",
            dealer: "E",
            vul: "None",
            your_seat: "S",
            hands: {
              N: { S: "KJ84", H: "A63", D: "Q72", C: "K85" },
              E: { S: "32", H: "K52", D: "AJ1098", C: "Q94" },
              S: { S: "AQ65", H: "KJ84", D: "6", C: "A732" },
              W: { S: "1097", H: "Q1097", D: "K543", C: "J10" }
            },
            correct_bid: "X",
            alternatives: [],
            teaching_point: "Takeout double shows support for unbid suits (both majors here)",
            optimal_contract: "4H by S",
            explanation: [
              "After RHO opens 1â™¦, double shows opening values and support for majors.",
              "Partner will bid their best major at appropriate level."
            ]
          },
          {
            id: "D02",
            module: "DEFENSE",
            title: "1NT Overcall",
            dealer: "W",
            vul: "None",
            your_seat: "S",
            hands: {
              N: { S: "J84", H: "A63", D: "Q72", C: "K985" },
              E: { S: "32", H: "K952", D: "J1098", C: "Q104" },
              S: { S: "AQ6", H: "KJ8", D: "AK64", C: "A73" },
              W: { S: "K10975", H: "Q1074", D: "53", C: "J2" }
            },
            correct_bid: "1NT",
            alternatives: [],
            teaching_point: "1NT overcall shows 15-18 HCP, balanced, with stopper in their suit",
            optimal_contract: "3NT by S",
            explanation: [
              "After 1â™ , 1NT shows 15-18 HCP, balanced, with spade stopper.",
              "This is natural and descriptive."
            ]
          },
          {
            id: "D03",
            module: "DEFENSE",
            title: "Weak Jump Overcall",
            dealer: "N",
            vul: "E/W",
            your_seat: "E",
            hands: {
              N: { S: "AKJ4", H: "A63", D: "AQ72", C: "K8" },
              E: { S: "32", H: "KQJ10985", D: "J8", C: "94" },
              S: { S: "Q865", H: "K2", D: "K64", C: "A732" },
              W: { S: "1097", H: "74", D: "10953", C: "QJ105" }
            },
            correct_bid: "3H",
            alternatives: ["2H"],
            teaching_point: "Weak jump overcall shows long suit (6+) and preemptive values",
            optimal_contract: "3H by E",
            explanation: [
              "After 1â™¦, jump to 3â™¥ shows weak hand with 6-7 hearts.",
              "This makes it harder for opponents to find their fit."
            ]
          },
          {
            id: "D04",
            module: "DEFENSE",
            title: "Responsive Double",
            dealer: "W",
            vul: "None",
            your_seat: "S",
            hands: {
              N: { S: "KJ84", H: "A63", D: "Q72", C: "K85" },
              E: { S: "32", H: "K952", D: "AJ1098", C: "Q4" },
              S: { S: "AQ65", H: "QJ84", D: "6", C: "A732" },
              W: { S: "1097", H: "107", D: "K543", C: "J1096" }
            },
            correct_bid: "X",
            alternatives: [],
            teaching_point: "Responsive double after partner's takeout shows values without clear direction",
            optimal_contract: "4S by N",
            explanation: [
              "After 1â™¦ - (X) - 2â™¦, double shows cards but no 5-card major.",
              "Let partner choose the strain."
            ]
          },
          {
            id: "D05",
            module: "DEFENSE",
            title: "Balancing",
            dealer: "E",
            vul: "None",
            your_seat: "S",
            hands: {
              N: { S: "KJ84", H: "A63", D: "K72", C: "K85" },
              E: { S: "32", H: "K952", D: "QJ10", C: "Q943" },
              S: { S: "AQ65", H: "QJ8", D: "A64", C: "732" },
              W: { S: "1097", H: "1074", D: "9853", C: "AJ10" }
            },
            correct_bid: "X",
            alternatives: ["1NT"],
            teaching_point: "In passout seat, reopen with lighter values to protect partner",
            optimal_contract: "2S by N",
            explanation: [
              "After 1â™¦ - P - P - ?, reopen with double (or 1NT).",
              "Partner may have been trapped with diamonds, give them another chance."
            ]
          }
        ];

        // Bid options with colors
        const BID_OPTIONS = [
          { label: 'Pass', value: 'Pass', color: 'gray' },
          { label: 'X', value: 'X', color: 'double' },
          { label: '1â™£', value: '1C', color: 'club' },
          { label: '1â™¦', value: '1D', color: 'diamond' },
          { label: '1â™¥', value: '1H', color: 'heart' },
          { label: '1â™ ', value: '1S', color: 'spade' },
          { label: '1NT', value: '1NT', color: 'nt' },
          { label: '2â™£', value: '2C', color: 'club' },
          { label: '2â™¦', value: '2D', color: 'diamond' },
          { label: '2â™¥', value: '2H', color: 'heart' },
          { label: '2â™ ', value: '2S', color: 'spade' },
          { label: '2NT', value: '2NT', color: 'nt' },
          { label: '3â™£', value: '3C', color: 'club' },
          { label: '3â™¦', value: '3D', color: 'diamond' },
          { label: '3â™¥', value: '3H', color: 'heart' },
          { label: '3â™ ', value: '3S', color: 'spade' },
          { label: '3NT', value: '3NT', color: 'nt' },
          { label: '4â™£', value: '4C', color: 'club' },
          { label: '4â™¦', value: '4D', color: 'diamond' },
          { label: '4â™¥', value: '4H', color: 'heart' },
          { label: '4â™ ', value: '4S', color: 'spade' },
          { label: '4NT', value: '4NT', color: 'nt' }
        ];

        const App = () => {
          const [currentView, setCurrentView] = useState('home'); // 'home', 'play', 'summary'
          const [selectedModule, setSelectedModule] = useState('ALL');
          const [sessionResults, setSessionResults] = useState([]);
          const [finalScore, setFinalScore] = useState(0);

          const handleStartSession = (module) => {
            setSelectedModule(module);
            setSessionResults([]);
            setFinalScore(0);
            setCurrentView('play');
          };

          const handleSessionComplete = (results, score) => {
            setSessionResults(results);
            setFinalScore(score);
            setCurrentView('summary');
          };

          return (
            <div style={{
              minHeight: '100vh',
              background: 'linear-gradient(135deg, #0f1419 0%, #1a2332 100%)',
              color: '#e8edf2',
              padding: '40px 20px'
            }}>
              {currentView === 'home' && (
                <HomeScreen onStartSession={handleStartSession} />
              )}
              {currentView === 'play' && (
                <AuctionTrainer 
                  selectedModule={selectedModule}
                  onSessionComplete={handleSessionComplete}
                  onNavigateHome={() => setCurrentView('home')}
                />
              )}
              {currentView === 'summary' && (
                <SummaryScreen 
                  results={sessionResults}
                  score={finalScore}
                  onNavigateHome={() => setCurrentView('home')}
                />
              )}
            </div>
          );
        };

        const HomeScreen = ({ onStartSession }) => {
          const modules = [
            { id: 'ALL', name: 'All Scenarios', description: '15 scenarios', color: '#60a5fa' },
            { id: 'BASIC', name: 'Uncontested', description: '5 scenarios', color: '#4ade80' },
            { id: 'COMPETE', name: 'Competitive', description: '5 scenarios', color: '#fb923c' },
            { id: 'DEFENSE', name: 'Defensive', description: '5 scenarios', color: '#f87171' }
          ];

          return (
            <div style={{ maxWidth: '900px', margin: '0 auto', textAlign: 'center' }}>
              <h1 style={{
                fontFamily: "'Playfair Display', serif",
                fontSize: '64px',
                marginBottom: '16px',
                background: 'linear-gradient(135deg, #4ade80 0%, #22d3ee 100%)',
                WebkitBackgroundClip: 'text',
                WebkitTextFillColor: 'transparent'
              }}>
                SLAM Auction
              </h1>
              <p style={{ fontSize: '20px', color: '#94a3b8', marginBottom: '60px' }}>
                Interactive Bridge Bidding Trainer with AI Partners
              </p>

              <div style={{
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                gap: '20px',
                marginBottom: '40px'
              }}>
                {modules.map(module => (
                  <button
                    key={module.id}
                    onClick={() => onStartSession(module.id)}
                    style={{
                      background: 'rgba(255, 255, 255, 0.03)',
                      border: `2px solid ${module.color}`,
                      borderRadius: '16px',
                      padding: '32px 24px',
                      cursor: 'pointer',
                      transition: 'all 0.2s',
                      textAlign: 'center'
                    }}
                    onMouseEnter={e => {
                      e.target.style.transform = 'translateY(-4px)';
                      e.target.style.boxShadow = `0 8px 24px ${module.color}40`;
                    }}
                    onMouseLeave={e => {
                      e.target.style.transform = 'translateY(0)';
                      e.target.style.boxShadow = 'none';
                    }}
                  >
                    <div style={{
                      fontSize: '24px',
                      fontWeight: '700',
                      color: module.color,
                      marginBottom: '8px'
                    }}>
                      {module.name}
                    </div>
                    <div style={{ fontSize: '14px', color: '#94a3b8' }}>
                      {module.description}
                    </div>
                  </button>
                ))}
              </div>

              <div style={{
                background: 'rgba(255, 255, 255, 0.03)',
                border: '1px solid rgba(255, 255, 255, 0.08)',
                borderRadius: '16px',
                padding: '24px',
                textAlign: 'left'
              }}>
                <h3 style={{ marginBottom: '16px', fontSize: '18px' }}>Scoring System</h3>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                  <div style={{
                    padding: '12px',
                    background: 'rgba(74, 222, 128, 0.1)',
                    border: '1px solid rgba(74, 222, 128, 0.3)',
                    borderRadius: '8px'
                  }}>
                    <strong style={{ color: '#4ade80' }}>3 points:</strong> Best bid
                  </div>
                  <div style={{
                    padding: '12px',
                    background: 'rgba(251, 146, 60, 0.1)',
                    border: '1px solid rgba(251, 146, 60, 0.3)',
                    borderRadius: '8px'
                  }}>
                    <strong style={{ color: '#fb923c' }}>2 points:</strong> Acceptable alternative
                  </div>
                  <div style={{
                    padding: '12px',
                    background: 'rgba(248, 113, 113, 0.1)',
                    border: '1px solid rgba(248, 113, 113, 0.3)',
                    borderRadius: '8px'
                  }}>
                    <strong style={{ color: '#f87171' }}>0 points:</strong> Not recommended
                  </div>
                </div>
              </div>
            </div>
          );
        };

        const SummaryScreen = ({ results, score, onNavigateHome }) => {
          const maxScore = results.length * 3;
          const percentage = Math.round((score / maxScore) * 100);

          return (
            <div style={{ maxWidth: '800px', margin: '0 auto' }}>
              <h1 style={{
                fontFamily: "'Playfair Display', serif",
                fontSize: '48px',
                marginBottom: '16px',
                textAlign: 'center'
              }}>
                Session Complete!
              </h1>

              <div style={{
                background: 'rgba(255, 255, 255, 0.03)',
                border: '2px solid rgba(74, 222, 128, 0.3)',
                borderRadius: '16px',
                padding: '40px',
                textAlign: 'center',
                marginBottom: '32px'
              }}>
                <div style={{ fontSize: '72px', fontWeight: '700', color: '#4ade80', marginBottom: '8px' }}>
                  {score}/{maxScore}
                </div>
                <div style={{ fontSize: '24px', color: '#94a3b8' }}>
                  {percentage}% Correct
                </div>
              </div>

              <div style={{
                display: 'flex',
                flexDirection: 'column',
                gap: '12px',
                marginBottom: '32px'
              }}>
                {results.map((result, i) => (
                  <div key={i} style={{
                    background: 'rgba(255, 255, 255, 0.03)',
                    border: `1px solid ${
                      result.points === 3 ? 'rgba(74, 222, 128, 0.3)' :
                      result.points === 2 ? 'rgba(251, 146, 60, 0.3)' :
                      'rgba(248, 113, 113, 0.3)'
                    }`,
                    borderRadius: '12px',
                    padding: '16px',
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center'
                  }}>
                    <div>
                      <div style={{ fontWeight: '600', marginBottom: '4px' }}>
                        {result.title}
                      </div>
                      <div style={{ fontSize: '14px', color: '#94a3b8' }}>
                        Your bid: {formatBid(result.bid)}
                      </div>
                    </div>
                    <div style={{
                      fontSize: '20px',
                      fontWeight: '700',
                      color: result.points === 3 ? '#4ade80' : result.points === 2 ? '#fb923c' : '#f87171'
                    }}>
                      +{result.points}
                    </div>
                  </div>
                ))}
              </div>

              <button
                onClick={onNavigateHome}
                style={{
                  width: '100%',
                  background: 'linear-gradient(135deg, #4ade80 0%, #22d3ee 100%)',
                  color: '#0f1419',
                  border: 'none',
                  borderRadius: '12px',
                  padding: '16px',
                  fontSize: '18px',
                  fontWeight: '600',
                  cursor: 'pointer'
                }}
              >
                Back to Home
              </button>
            </div>
          );
        };

        const AuctionTrainer = ({ selectedModule, onSessionComplete, onNavigateHome }) => {
          // Filter scenarios by module
          const filteredScenarios = selectedModule === 'ALL' 
            ? SCENARIOS 
            : SCENARIOS.filter(s => s.module === selectedModule);
          
          const [currentScenarioIndex, setCurrentScenarioIndex] = useState(0);
          const [sessionResults, setSessionResults] = useState([]);
          const [sessionScore, setSessionScore] = useState(0);

          const scenario = filteredScenarios[currentScenarioIndex];

        const BidButton = ({ bid, onClick, disabled = false }) => {
          const [isHovered, setIsHovered] = useState(false);

          const getColorScheme = (color) => {
            const schemes = {
              gray: { bg: 'rgba(148, 163, 184, 0.1)', border: 'rgba(148, 163, 184, 0.3)', text: '#cbd5e1' },
              club: { bg: 'rgba(22, 101, 52, 0.2)', border: 'rgba(74, 222, 128, 0.4)', text: '#4ade80' },
              diamond: { bg: 'rgba(234, 88, 12, 0.2)', border: 'rgba(251, 146, 60, 0.4)', text: '#fb923c' },
              heart: { bg: 'rgba(220, 38, 38, 0.2)', border: 'rgba(248, 113, 113, 0.4)', text: '#f87171' },
              spade: { bg: 'rgba(15, 20, 25, 0.4)', border: 'rgba(226, 232, 240, 0.4)', text: '#e2e8f0' },
              nt: { bg: 'rgba(59, 130, 246, 0.2)', border: 'rgba(96, 165, 250, 0.4)', text: '#60a5fa' },
              double: { bg: 'rgba(251, 146, 60, 0.2)', border: 'rgba(251, 146, 60, 0.4)', text: '#fb923c' }
            };
            return schemes[color] || schemes.gray;
          };

          const colors = getColorScheme(bid.color);

          return (
            <button
              onClick={disabled ? null : onClick}
              onMouseEnter={() => !disabled && setIsHovered(true)}
              onMouseLeave={() => setIsHovered(false)}
              disabled={disabled}
              style={{
                background: disabled 
                  ? 'rgba(255, 255, 255, 0.02)' 
                  : isHovered ? colors.bg : 'rgba(255, 255, 255, 0.05)',
                border: `2px solid ${disabled 
                  ? 'rgba(255, 255, 255, 0.05)' 
                  : isHovered ? colors.border : 'rgba(255, 255, 255, 0.1)'}`,
                borderRadius: '8px',
                padding: '12px 8px',
                color: disabled ? 'rgba(255, 255, 255, 0.2)' : colors.text,
                fontSize: '16px',
                fontWeight: '600',
                cursor: disabled ? 'not-allowed' : 'pointer',
                transition: 'all 0.2s',
                opacity: disabled ? 0.3 : 1,
                transform: isHovered && !disabled ? 'translateY(-2px)' : 'translateY(0)',
                boxShadow: isHovered && !disabled ? `0 4px 12px ${colors.border}` : 'none'
              }}
            >
              {bid.label}
            </button>
          );
        };

        const AuctionTrainer = ({ selectedModule, onSessionComplete, onNavigateHome }) => {
          // Filter scenarios by module
          const filteredScenarios = selectedModule === 'ALL' 
            ? SCENARIOS 
            : SCENARIOS.filter(s => s.module === selectedModule);
          
          const [currentScenarioIndex, setCurrentScenarioIndex] = useState(0);
          const [sessionResults, setSessionResults] = useState([]);
          const [sessionScore, setSessionScore] = useState(0);

          const scenario = filteredScenarios[currentScenarioIndex];
          const [isHovered, setIsHovered] = useState(false);

          const getColorScheme = (color) => {
            const schemes = {
              gray: { bg: 'rgba(148, 163, 184, 0.1)', border: 'rgba(148, 163, 184, 0.3)', text: '#cbd5e1' },
              club: { bg: 'rgba(22, 101, 52, 0.2)', border: 'rgba(74, 222, 128, 0.4)', text: '#4ade80' },
              diamond: { bg: 'rgba(234, 88, 12, 0.2)', border: 'rgba(251, 146, 60, 0.4)', text: '#fb923c' },
              heart: { bg: 'rgba(220, 38, 38, 0.2)', border: 'rgba(248, 113, 113, 0.4)', text: '#f87171' },
              spade: { bg: 'rgba(15, 20, 25, 0.4)', border: 'rgba(226, 232, 240, 0.4)', text: '#e2e8f0' },
              nt: { bg: 'rgba(59, 130, 246, 0.2)', border: 'rgba(96, 165, 250, 0.4)', text: '#60a5fa' },
              double: { bg: 'rgba(251, 146, 60, 0.2)', border: 'rgba(251, 146, 60, 0.4)', text: '#fb923c' }
            };
            return schemes[color] || schemes.gray;
          };

          const colors = getColorScheme(bid.color);

          return (
            <button
              onClick={disabled ? null : onClick}
              onMouseEnter={() => !disabled && setIsHovered(true)}
              onMouseLeave={() => setIsHovered(false)}
              disabled={disabled}
              style={{
                background: disabled 
                  ? 'rgba(255, 255, 255, 0.02)' 
                  : isHovered ? colors.bg : 'rgba(255, 255, 255, 0.05)',
                border: `2px solid ${disabled 
                  ? 'rgba(255, 255, 255, 0.05)' 
                  : isHovered ? colors.border : 'rgba(255, 255, 255, 0.1)'}`,
                borderRadius: '8px',
                padding: '12px 8px',
                color: disabled ? 'rgba(255, 255, 255, 0.2)' : colors.text,
                fontSize: '16px',
                fontWeight: '600',
                cursor: disabled ? 'not-allowed' : 'pointer',
                transition: 'all 0.2s',
                opacity: disabled ? 0.3 : 1,
                transform: isHovered && !disabled ? 'translateY(-2px)' : 'translateY(0)',
                boxShadow: isHovered && !disabled ? `0 4px 12px ${colors.border}` : 'none'
              }}
            >
              {bid.label}
            </button>
          );
        };

        const AuctionTrainer = () => {
          const [scenario] = useState(SCENARIOS[0]);
          const [auction, setAuction] = useState([
            // Start with dealer's opening bid (for now, just first scenario's opening)
            { seat: scenario.dealer, bid: getOpeningBid(scenario), reasoning: getOpeningReasoning(scenario) }
          ]);
          const [currentSeat, setCurrentSeat] = useState(getNextSeat(scenario.dealer));
          const [isThinking, setIsThinking] = useState(false);
          const [auctionComplete, setAuctionComplete] = useState(false);
          const [finalContract, setFinalContract] = useState(null);
          const [userBid, setUserBid] = useState(null); // Track user's first bid for scoring
          const [showFeedback, setShowFeedback] = useState(false);

          // Helper to determine opening bid based on scenario
          function getOpeningBid(scen) {
            // Extract from optimal contract or use 1NT for simplicity
            if (scen.id === 'U01' || scen.id === 'U02') return '1NT';
            if (scen.id === 'U03') return '1S';
            if (scen.id === 'U04') return '2S';
            if (scen.id === 'U05') return '1S';
            // For competitive/defensive, extract from teaching point
            if (scen.module === 'COMPETE' || scen.module === 'DEFENSE') {
              // Parse from teaching point or optimal contract
              return '1D'; // Default, should be customized per scenario
            }
            return '1C';
          }

          function getOpeningReasoning(scen) {
            if (getOpeningBid(scen) === '1NT') return '15-17 HCP, balanced';
            if (getOpeningBid(scen) === '2S') return 'Weak 2, 6 spades';
            return 'Opening bid';
          }

          // Check if auction is complete (3 consecutive passes)
          const checkAuctionComplete = (auctionBids) => {
            if (auctionBids.length < 4) return false;
            const last3 = auctionBids.slice(-3);
            return last3.every(b => b.bid === 'Pass');
          };

          // Get Claude to bid for other players (via backend)
          const getClaudeBid = async (seat) => {
            setIsThinking(true);
            
            try {
              const auctionStr = auction.map(b => `${b.seat}: ${b.bid}`).join(', ');
              const handStr = `North: Spades ${scenario.hands.N.S}, Hearts ${scenario.hands.N.H}, Diamonds ${scenario.hands.N.D}, Clubs ${scenario.hands.N.C}
East: Spades ${scenario.hands.E.S}, Hearts ${scenario.hands.E.H}, Diamonds ${scenario.hands.E.D}, Clubs ${scenario.hands.E.C}
South: Spades ${scenario.hands.S.S}, Hearts ${scenario.hands.S.H}, Diamonds ${scenario.hands.S.D}, Clubs ${scenario.hands.S.C}
West: Spades ${scenario.hands.W.S}, Hearts ${scenario.hands.W.H}, Diamonds ${scenario.hands.W.D}, Clubs ${scenario.hands.W.C}`;
              
              const prompt = `You are playing bridge as seat ${seat}. You can see all 4 hands (this is a training scenario).

**All Hands:**
${handStr}

**Auction so far:** ${auctionStr}
**Dealer:** ${scenario.dealer}
**Vulnerability:** ${scenario.vul}
**Your seat:** ${seat}
**Your hand:** Spades: ${scenario.hands[seat].S}, Hearts: ${scenario.hands[seat].H}, Diamonds: ${scenario.hands[seat].D}, Clubs: ${scenario.hands[seat].C}

**Teaching point:** ${scenario.teaching_point}
**Optimal contract:** ${scenario.optimal_contract}

What should ${seat} bid? Respond with ONLY a JSON object (no markdown, no backticks, just pure JSON):
{"bid": "Pass", "reasoning": "Brief explanation"}

The bid must be legal (higher than the last bid or Pass). Make realistic bids that help guide the student toward the optimal contract.`;

              console.log('Calling backend API for seat:', seat);
              
              // Call our backend instead of Anthropic directly
              const response = await fetch("http://localhost:5000/api/bid", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ prompt })
              });

              if (!response.ok) {
                throw new Error(`Backend error: ${response.status}`);
              }

              const data = await response.json();
              console.log('Backend API response:', data);
              
              if (data.error) {
                throw new Error(data.error);
              }
              
              const text = data.content.find(c => c.type === "text")?.text || "";
              console.log('Extracted text:', text);
              
              const cleaned = text.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
              const result = JSON.parse(cleaned);
              
              console.log('Parsed result:', result);
              
              setIsThinking(false);
              return result;
              
            } catch (error) {
              console.error('Error getting Claude bid:', error);
              setIsThinking(false);
              
              // Better fallback based on position
              if (seat === scenario.your_seat) {
                return { bid: 'Pass', reasoning: 'Error - your turn' };
              }
              
              // Opponents usually pass
              if (seat === 'E' || seat === 'W') {
                return { bid: 'Pass', reasoning: 'No overcall' };
              }
              
              // Partner - pass for safety
              return { bid: 'Pass', reasoning: `API error: ${error.message}` };
            }
          };

          // Add bid to auction and advance
          const addBid = (bid, reasoning = '') => {
            const newAuction = [...auction, { seat: currentSeat, bid, reasoning }];
            setAuction(newAuction);
            
            // Check if complete
            if (checkAuctionComplete(newAuction)) {
              setAuctionComplete(true);
              const lastNonPass = newAuction.slice().reverse().find(b => b.bid !== 'Pass');
              if (lastNonPass) {
                setFinalContract(`${formatBid(lastNonPass.bid)} by ${lastNonPass.seat}`);
              }
            } else {
              setCurrentSeat(getNextSeat(currentSeat));
            }
          };

          // Handle user's bid
          const handleUserBid = (bid) => {
            addBid(bid, 'Your bid');
          };

          // Auto-bid for other players
          useEffect(() => {
            if (!auctionComplete && currentSeat !== scenario.your_seat && !isThinking) {
              // It's not your turn - Claude bids
              getClaudeBid(currentSeat).then(result => {
                addBid(result.bid, result.reasoning);
              });
            }
          }, [currentSeat, auctionComplete]);

          const isYourTurn = currentSeat === scenario.your_seat && !auctionComplete;
          const lastBid = auction.length > 0 ? auction[auction.length - 1].bid : null;

          // Check if a bid is legal
          const isBidLegal = (bid) => {
            if (bid === 'Pass' || bid === 'X') return true;
            if (!lastBid || lastBid === 'Pass') return true;
            
            const getBidValue = (b) => {
              if (b === 'Pass' || b === 'X') return -1;
              const level = parseInt(b.charAt(0));
              const suitOrder = { 'C': 0, 'D': 1, 'H': 2, 'S': 3, 'NT': 4 };
              const suit = b.substring(1);
              return level * 5 + (suitOrder[suit] || 0);
            };
            
            return getBidValue(bid) > getBidValue(lastBid);
          };

          return (
            <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
              <h1 style={{
                fontFamily: "'Playfair Display', serif",
                fontSize: '48px',
                marginBottom: '8px',
                background: 'linear-gradient(135deg, #4ade80 0%, #22d3ee 100%)',
                WebkitBackgroundClip: 'text',
                WebkitTextFillColor: 'transparent'
              }}>
                SLAM Auction Interactive
              </h1>
              <p style={{ color: '#94a3b8', marginBottom: '40px', fontSize: '18px' }}>
                {scenario.title}
              </p>

              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '24px', marginBottom: '24px' }}>
                {/* Left: Your Hand */}
                <div style={{
                  background: 'rgba(255, 255, 255, 0.03)',
                  border: '1px solid rgba(255, 255, 255, 0.08)',
                  borderRadius: '16px',
                  padding: '24px'
                }}>
                  <h3 style={{ marginBottom: '16px', fontSize: '18px' }}>
                    Your Hand ({scenario.your_seat})
                  </h3>
                  <HandDisplay hand={scenario.hands[scenario.your_seat]} />
                  
                  <div style={{
                    marginTop: '20px',
                    padding: '16px',
                    background: 'rgba(34, 211, 238, 0.1)',
                    border: '1px solid rgba(34, 211, 238, 0.3)',
                    borderRadius: '8px',
                    fontSize: '14px',
                    color: '#22d3ee'
                  }}>
                    ðŸ’¡ {scenario.teaching_point}
                  </div>
                </div>

                {/* Right: Auction */}
                <div style={{
                  background: 'rgba(255, 255, 255, 0.03)',
                  border: '1px solid rgba(255, 255, 255, 0.08)',
                  borderRadius: '16px',
                  padding: '24px'
                }}>
                  <h3 style={{ marginBottom: '16px', fontSize: '18px' }}>
                    Auction {auctionComplete && '(Complete)'}
                  </h3>
                  
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '8px', marginBottom: '20px' }}>
                    {auction.map((bid, i) => (
                      <div key={i} style={{
                        padding: '12px',
                        background: bid.seat === scenario.your_seat ? 'rgba(74, 222, 128, 0.1)' : 'rgba(255, 255, 255, 0.05)',
                        border: `1px solid ${bid.seat === scenario.your_seat ? 'rgba(74, 222, 128, 0.3)' : 'rgba(255, 255, 255, 0.1)'}`,
                        borderRadius: '8px',
                        display: 'flex',
                        gap: '12px',
                        alignItems: 'center'
                      }}>
                        <div style={{ fontWeight: '700', minWidth: '24px', color: '#94a3b8' }}>
                          {bid.seat}
                        </div>
                        <div style={{ fontSize: '20px', fontWeight: '700', minWidth: '60px' }}>
                          {formatBid(bid.bid)}
                        </div>
                        {bid.reasoning && (
                          <div style={{ fontSize: '13px', color: '#94a3b8', fontStyle: 'italic' }}>
                            {bid.reasoning}
                          </div>
                        )}
                      </div>
                    ))}
                    
                    {isThinking && (
                      <div style={{
                        padding: '16px',
                        background: 'rgba(34, 211, 238, 0.1)',
                        border: '1px solid rgba(34, 211, 238, 0.3)',
                        borderRadius: '8px',
                        textAlign: 'center',
                        color: '#22d3ee'
                      }}>
                        ðŸ¤” {currentSeat} is thinking...
                      </div>
                    )}
                  </div>

                  {auctionComplete && finalContract && (
                    <div style={{
                      padding: '16px',
                      background: 'rgba(74, 222, 128, 0.1)',
                      border: '1px solid rgba(74, 222, 128, 0.3)',
                      borderRadius: '8px'
                    }}>
                      <div style={{ fontSize: '12px', color: '#94a3b8', marginBottom: '6px' }}>
                        FINAL CONTRACT
                      </div>
                      <div style={{ fontSize: '24px', fontWeight: '700', color: '#4ade80' }}>
                        {finalContract}
                      </div>
                      <div style={{ fontSize: '14px', color: '#cbd5e1', marginTop: '8px' }}>
                        Optimal was: {scenario.optimal_contract}
                      </div>
                    </div>
                  )}
                </div>
              </div>

              {/* Bidding Interface */}
              {isYourTurn && !isThinking && (
                <div style={{
                  background: 'rgba(255, 255, 255, 0.03)',
                  border: '1px solid rgba(255, 255, 255, 0.08)',
                  borderRadius: '16px',
                  padding: '24px'
                }}>
                  <h3 style={{ marginBottom: '20px', textAlign: 'center', fontSize: '18px' }}>
                    Your Turn - What's your bid?
                  </h3>
                  <div style={{
                    display: 'grid',
                    gridTemplateColumns: 'repeat(auto-fill, minmax(70px, 1fr))',
                    gap: '8px'
                  }}>
                    {BID_OPTIONS.map(bid => (
                      <BidButton
                        key={bid.value}
                        bid={bid}
                        onClick={() => handleUserBid(bid.value)}
                        disabled={!isBidLegal(bid.value)}
                      />
                    ))}
                  </div>
                </div>
              )}
            </div>
          );
        };

        const HandDisplay = ({ hand }) => {
          const suits = [
            { symbol: 'â™ ', name: 'S', color: '#000', bgColor: '#e2e8f0', holding: hand.S },
            { symbol: 'â™¥', name: 'H', color: '#dc2626', bgColor: '#fee2e2', holding: hand.H },
            { symbol: 'â™¦', name: 'D', color: '#ea580c', bgColor: '#fed7aa', holding: hand.D },
            { symbol: 'â™£', name: 'C', color: '#166534', bgColor: '#dcfce7', holding: hand.C }
          ];

          return (
            <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>
              {suits.map(suit => (
                <div key={suit.name} style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                  <div style={{
                    width: '32px',
                    height: '32px',
                    borderRadius: '6px',
                    background: suit.bgColor,
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontSize: '20px',
                    color: suit.color,
                    fontWeight: '700',
                    flexShrink: 0
                  }}>
                    {suit.symbol}
                  </div>
                  <div style={{
                    fontSize: '18px',
                    fontWeight: '600',
                    letterSpacing: '0.08em',
                    color: '#e8edf2'
                  }}>
                    {suit.holding}
                  </div>
                </div>
              ))}
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
